{% extends 'birds/base.html' %}



{% block content %}

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


<div class="page-content">
	<section class="mdl-grid">
		<div class="mdl-cell mdl-cell--8-col mdl-cell--1-offset-desktop">
			<div class="card-bird mdl-card mdl-shadow--3dp"> 
				<div class="mdl-card__title news-title">
					<h2 class="mdl-card__title-text">New Sighting </h2>
				</div>
				<div class="mdl-card__supporting-text news-text">
					<form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
						{{ form.as_p }}
						<input id="save_button" type="submit" value="Save" />
					</form>
					<div id="msg"><p>Please indicate sighting location.</p></div>
					<div id="map"></div>
					<script type="text/javascript">
						jQuery(function($){
							$('#id_sighting_date').datepicker();
							$('#save_button').button();

							var pos = { lat: 0, lng: 0 }
							var map = new google.maps.Map(document.getElementById('map'), {
								zoom: 14,
								center: pos
							})

							var marker = new google.maps.Marker({
								position: pos,
								icon: {
									path: google.maps.SymbolPath.CIRCLE,
									scale: 5
								},
								draggable: true,
								map: map
							});

							map.addListener('center_changed', function() {
								pos = map.getCenter()
								$('#id_lat').val(pos.lat())
								$('#id_lng').val(pos.lng())
								marker.setPosition(pos)
							})

							if (navigator.geolocation) {
								navigator.geolocation.getCurrentPosition(function(position) {
									pos = {
										lat: position.coords.latitude,
										lng: position.coords.longitude
									}
									map.setCenter(pos);
								}, function() {
									$('#msg').html("<p>Geolocation Service Failed.</p>")
								})
							} else {
				    			// Browser doesn't support Geolocation
				    			$('#msg').html("<p>Browser doesn't support geolocation.</p>")
    								}})
    				</script>
				</div>
			</div>
		</div>
	</section>
</div>
{% endblock %}

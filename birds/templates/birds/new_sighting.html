{% extends 'birds/base.html' %}



{% block content %}

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


<div class="page-content">
	<section class="mdl-grid">
		<div class="mdl-cell mdl-cell--8-col mdl-cell--1-offset-desktop">
			<div class="card-bird mdl-card mdl-shadow--3dp"> 
				<div class="mdl-card__title news-title">
					<h2 class="mdl-card__title-text">New Sighting </h2>
				</div>
				<div class="mdl-card__supporting-text news-text">
					<form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
                        {% for field in form.visible_fields %}
                            {% if field.field.widget.attrs.class == "mdl-textfield__input" %}
                                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                    <label class="mdl-textfield__label" for="{{ field.name }}">{{ field.label }}</label>
                                    {{ field }}
                                </div>
                            {% else %}
                                <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                    <label class="" for="{{ field.name }}">{{ field.label }}</label>
                                    {{ field }}
                                </div>
                            {% endif %}
                        {% endfor %}
                        {% for field in form.hidden_fields %}
                            {{ field }}
                        {% endfor %}
                        <input class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id="save_button" type="submit" value="Save" />
						
					</form>
					<div id="msg"><p>Please indicate sighting location.</p></div>
					<div id="map"></div>
				</div>
			</div>
		</div>
	</section>
</div>
<script type="text/javascript">
    jQuery(function($){
        $('#id_sighting_date').datepicker();

        var pos = { lat: 0, lng: 0 }
        var map = new google.maps.Map(document.getElementById('map'), { zoom: 14, center: pos })

        var marker = new google.maps.Marker({
            position: pos, icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 5
            },
            draggable: true,
            map: map
        })

        map.addListener('center_changed', function() {
            pos = map.getCenter()
            $('#id_lat').val(pos.lat())
            $('#id_lng').val(pos.lng())
            marker.setPosition(pos)
            $.ajax({
                url: "https://maps.googleapis.com/maps/api/geocode/json?latlng=40.714224,-73.961452&key=AIzaSyDcWjuyosd0o5iQ2am9FFN2IC568p6-VCU",
                dataType: "json",
                succes: function(data, textStatus, jqXHR){
                    alert(data);
                })
            })
        })

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                }
                map.setCenter(pos);
            }, function() {
                $('#msg').html("<p>Geolocation Service Failed.</p>")
            })
        } else {
            // Browser doesn't support Geolocation
            $('#msg').html("<p>Browser doesn't support geolocation.</p>")
        }
    })
</script>
{% endblock %}
